# 4th Sept 2024 - Watch SHM MOD 1.3.2.025
Android Manifest:
- Sleep Apnea observed, added and activated...
- A lot of system permissions added, will be cleaned when patching to ensure signature verification not triggered nor conflict with stock shm...
- a lot of services added with heavy constraints that would suspend them, battery_low, device_storage_low, or reschedule when device time_zone_change...

GUI:
- Plenty of messages for Sleep Apnea, indicating Sleep Apnea does not run for more than 10 days, and it needs 2 days to calibrate for each run...

CODE:
- using defpackage, a lisp, or a way to make development easy but obscure and randomize the code, this was a big pain to patch, i do hope they don't go this path, otherwise, patching will always take a lot of time...
- As suspected Apnea first restriction is UI6...
- Apnea Countries: United States (US), South Korea (KR), Bolivia (BO), Chile (CL), United Arab Emirates (AE), Philippines (PH), Mauritius (MU), South Africa (ZA), Hong Kong (HK), Russia (RU), Georgia (GE), Azerbaijan (AZ), Peru (PE)
- Animated Tiles require system level to run, changed into static images...

~~

# History
> The updates here are for WearOS only, Tizen does not have much as it's compiled bin/lib file...
> Old History does not have detailed changelog, because I was only patching in the past

## 2024
### 8th April 2024 - 1.2.6.002

> Patch #1 - 14th May 2024 - This Patch is mainly for those with Custom ROM with device Spoofing that has Bluetooth Class not correctly configured by the ROM/Kernel developer...
>  - Bluetooth Device Class check... if SmartPhone (524) return true, else returns false device is not SMART_PHONE
>  - Override and return true always

Android Manifest:
- Nothing New observed...

GUI:
- Proper Description of permissions and setting them up correctly to prevent Services from being killed or removed by Watch OS...
  - permission_bluetooth_description: Used to scan for and connect to nearby devices
  - permission_notification_desc: Used to provide you with timely information
  - permission_sensor_notice_cause: Used to provide measurements such as blood pressure and ECG

Since OS remove unused permissions from time to time, this causes stock SHM to crash on start, and I have seen this a lot... 

CODE:
- Aside from checking watch connected to Samsung Phone, there is a check if the phone is verizon when samsung fails, odd device restriction check...
- They added on watch connect, start service but that will not work if the watch booted it up for the first time...

NOTE:
- in the current 1.2.5.002 Patch #2, if you use ECG Tile or BP Tile, even after reboot, the service does not start, I missed this part, I should add the same logic of checking and starting service from the main activity into the Tile Activity, So I will make sure in 1.2.6.002, IHRN service is handled correctly in all cases...

New Approach for handling IHRN:
- Enhanced handling of service start, by checking several flags, isIhrnEnabled and check scheduled IHRN, the service starter will be called when conditions are satisfied where ihrn enabled is true and if IHRN is not scheduled, this will handle cases where device reboots, and it's more battery friendly...
- This patch has been injected into MainActivity (opening the app), Tile activity (from outside) for both BP and ECG, finally, and just to be safe, in both ECG and BP MainActivities...
- Make sure you have BP or ECG Tile set, when you watch boots up, tile creation activity is called, it will run the IHRN Service via the tile...
---
### February
 * Patch #2 - 28th Feb 2024 - Fixed issue with BP measurement Resources due to bad compilation...
 * Patch #1 - 26th Feb 2024 - Patched the service module, adding isRunning flag to the service module to check if service is running or not, and Added method StartService on MainActivity, this will ensure all services of SHM MOD on the watch are running (including IHRN), because of the flag isRunning, the Service will only start if it's not running (graceful handle)...

### January 2024
 * 15th January 2024 - 1.2.5.002
---
GUI:
 * ECG layout has been split into 2 layouts but nothing major...
 * Translations added: AS-IN (Assamese - India), BN-IN (Bengali), GU-IN (Gujarati - India), KN-IN (Kannada - India), ML-IN (Malayalam), MR-IN (Marathi - India), NE (Nepal), OR-IN (Odia or Oriya - India), SI (Sri Lanka), TA-IN (Tamil - India), TE-IN (Telugu - India), UR (Urdu) translations added by Samsung...

CODE:
 * CSCUtil,Adding countries back and defining them as EU_CSC & sEUCountry, but those values have no value or use, perhaps future update to utilize it...
 * Global Setting mode (detect theatre, bed time, kids mode and zen mode of the watch), possible use in the future?
 * They still show IHRN alert with sound and vibration, I have applied my fix (display correct message and silent the measuring notice)...

I still had to apply same patches for IHRN in Watch SHM:
 * Samsung IHRN auto-measurements were using wrong display messages (showing afib detected instead of auto measurement) and triggers sound + vibration notification every 10 minutes, I have fixed this by putting approprite message and set the notification as silent...
---

## 2023
### November 2023
 * 11th November 2023 - 1.2.2.005
---
 * a new layout added "BP not supported", this means BP will be controlled from the watch as well...
 * They added several messages "need a samsung device to uuse SHM", and "BP not approved in your region", also for calibratiion, they changed the message into "Wear your watch snugly, away from the wrist bone. Also, relax your hands and arms."
 * They added Device ID Service, probably to get the Device ID and not generate it randomly...
 * Well, the code i removed in SHM MOD 1.2.1.009, they have removed it in 1.2.2.005, this code was causing random crashes, this means my decision was correct...
 * IHRN on watch is heavily patched, hopefully it will stop IHRN suspending because the code looks promising now but I don't see any fix for the messages, vibrations and sounds... 
 * Chinese simplified has a custom icon for BP and ECG tiles...
 * Watch detects phone model, if not Samsung, show message "Samsung device required for using shm"
---

### August 2023
 * 9th August 2023 - 1.2.1.009
---
 * IHRN Feature unlocked...
 * Lowered WearOS Requirement, it can work on old WearOS 3.5...
 * Fixed a bug where IHRN measurements would notify (vibrate + sound) every 10 mins with wrong message "afib detected"...
 * Fixed Double BP and ECG tiles...
---
---
### Februray 2023 - Tizen + WearOS
 * 13th Feb 2023 - SHM 225 (Watch) released
---
 > Patch #1 - 17th Feb 2023 - Forgot to add the custom languages into the mod, ex: malaysia, japaanese, chinese, etc...
 * Force phone shm to match the latest version on Galaxy store (bypassed)...
 * More optimization in BP and ECG Code (might be me but recording is slightly faster)...
---

## 2022
### October 2022
 * 24th Oct 2022 - SHM 221 (Watch) released.
---
 * They no longer check for the region, my guess is, the app is disabled and enabled based on watch CSC, but only US has method isECGOnly...
 * Optimization in BP and ECG Code...
 * Polished UI Interface a bit...
---

### August 2022
 * 17th Aug 2022 - SHM 215 (Watch) released
---
 * Turkey (TR) BP & ECG Support

 -> Where are the other countries...?
     Peru (PE), Bolivia (BO), RÃ©union (RE - island in France), Nicaragua (NI), Venezuela (VE) are not there but exist on the phone SHM...

 * They added wrist position logic in BP & ECG...
 * I also see a lot of UI changes...
 * BP and ECG code is heavily modified with new logic...
 * Wear connectivity code has changed as well...
---

### April 2022 - SHM 203 (Watch) released - no changelog was made...

### Februray 2022 - SHM 193 (Watch) released - no changelog was made...

## 2021
### November 2021 - SHM 185 (Watch) released - no changelog was made...

### September 2021 - SHM 157 (Watch) released - no changelog was made...

### Augsut 2021 - SHM 153 (Watch) released - no changelog was made...
